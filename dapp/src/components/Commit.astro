---
import Topic from "./Topic.astro";
import Loading from "./Loading.astro";
---

<div class="relative flex flex-col items-center md:flex-row">
  <Topic title="Commit" description="Update hash on-chain" />
</div>

<div
  class="relative flex flex-col items-center md:flex-row my-6 bg-zinc-100 rounded-[45px]"
>
  <div class="row items-center py-12 px-4 md:px-20 md:w-8/12 md:py-10">
    <div class="space-y-8 md:w-full">
      <label class="block mb-2 text-base font-medium text-black">
        Commit hash
        <input
          type="text"
          id="commit_hash"
          name="commit_hash"
          class="block p-3 w-full text-base text-black bg-white rounded-lg border shadow-sm focus:ring-black focus:border-black"
          placeholder="Last commit hash"
          required
          minlength="40"
          maxlength="40"
        />
      </label>
      <button
        data-commit-hash
        aria-controls="commit-hash"
        class="w-full py-5 bg-zinc-900 rounded-[14px] justify-center gap-2.5 inline-flex"
      >
        <span class="text-center text-white text-xl font-normal leading-7"
          >Commit on-chain</span
        >
      </button>
    </div>
  </div>
</div>

<div class="relative flex flex-col items-center md:flex-row">
  <Topic title="Latest hash" description="Get the latest hash on-chain" />
</div>

<div
  class="relative flex flex-col items-center md:flex-row my-6 bg-zinc-100 rounded-[45px]"
>
  <div class="row items-center py-12 px-4 md:px-20 md:w-8/12 md:py-10">
    <div id="wrap-get-hash-button" class="space-y-8 md:w-full">
      <button
        data-project-get-hash
        class="w-full py-5 bg-zinc-900 rounded-[14px] justify-center gap-2.5 inline-flex"
      >
        <span class="text-center text-white text-xl font-normal leading-7"
          >Latest hash</span
        >
      </button>
    </div>
    <div id="wrap-get-hash-loader" class="hidden">
      <Loading />
    </div>
  </div>
</div>

<script>
  import { getProjectHash } from "./project";

  const wrap_loader = document.getElementById(
    "wrap-get-hash-loader",
  ) as HTMLDivElement;
  const wrap_button = document.getElementById(
    "wrap-get-hash-button",
  ) as HTMLDivElement;
  const button = document.querySelector(
    "[data-project-get-hash]",
  ) as HTMLButtonElement;

  button.addEventListener("click", async () => {
    wrap_loader.style.display = "block";
    wrap_button.style.display = "none";
    try {
      const project_hash = await getProjectHash();

      wrap_loader.style.display = "none";
      wrap_button.style.display = "block";
      wrap_button.innerHTML = `${project_hash}`;
    } catch (e) {
      console.error(e);
    }
  });
</script>
